<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">	

	<insert id="signupInsert" parameterType="net.hb.crud.BoardDTO">
	   insert into customer
	   values(customer_seq.nextVal, #{custname}, #{custid}, #{custpassword}, #{clevel}, 0)    
	</insert>
	
	
	<insert id='writeInsert'>
		insert into board values(board_seq.nextval, #{custid}, #{topic}, #{title}, #{bcontent}, sysdate, 0, 0)
	</insert>
	
	<!-- 검색+페이징 내가만든 원본 -->
	<select id="boardSelect" parameterType="net.hb.crud.BoardDTO" resultType="net.hb.crud.BoardDTO">
	    select rownum rn, board_idx, custid, topic, title, bcontent, to_char(wdate,'YYYY.MM.DD') as wdate, hit, blike
		from (select rownum rn, b.* from board b 
		where topic like '%' || #{topic} || '%' 
		and ${skey} like '%' || #{sval} || '%'
		order by board_idx desc) 
		where rn between #{start} and #{end}
	</select>
	
	<!-- 쌤이 만든 검색+페이징 -->
	<select id="boardSelect2" parameterType="net.hb.crud.BoardDTO" resultType="net.hb.crud.BoardDTO">
	    select * from  (
	    select rownum rn, h.* ,(select count(*) from board_reply r where r.board_idx=h.board_idx) as rcnt from 
	     (select * from board where ${skey} like '%' || #{sval} || '%' ) h 
	  ) where rn between #{start} and #{end} 
	</select>
	
	<select id="detail" resultType="net.hb.crud.BoardDTO">
	   select  board_idx, custid, topic, title, bcontent, to_char(wdate,'YYYY.MM.DD') as wdate, hit, blike
	   from board where board_idx=#{board_idx}
	</select>
	
	<!-- 추천 -->
	
	<select id="LikeCheck" resultType="int">
	    select count(*) as cnt from board_heart where hwriter=#{hwriter} and board_idx=#{board_idx}
	</select>
	
	<update id="LikePlusOne">
		update board set blike = blike + 1 where board_idx=#{board_idx}
	</update>
	
	<update id="LikeMinusOne">
		update board set blike = blike - 1 where board_idx=#{board_idx}
	</update>
	
	<insert id='likeInsert' >
		insert into board_heart values(#{hwriter}, #{board_idx})
	</insert>
	
	<delete id='likeDelete' >
		delete from board_heart where hwriter=#{hwriter} and board_idx=#{board_idx}
	</delete>
	
	<!-- 조회수 -->
	
	<update id="BoardAddhit">
		update board set hit = hit + 1 where board_idx=#{board_idx}
	</update>
	
	<!-- 단어출력 -->
	<select id="wordSelect" resultType='net.hb.crud.BoardDTO'>
	   select rownum rn, v.* from vocabulary v
	</select>
	
	<select id="wordCount" resultType='int'>
		select count(*) from vocabulary
	</select>
	
	<select id="wordSelectOne" resultType='net.hb.crud.BoardDTO'>
	   select * from (select rownum wrn, v.* from vocabulary v) where wrn=#{wrn}
	</select>
	
	<!-- 단어예문 삽입 -->
	
	<!-- 게시글 갯수 -->
	<select id="countAll" resultType="int">
	   select count(*)  from board
	</select>
	
	
	<!-- 1015 -->
	<!--  검색 후 레코드갯수  -->
	<select id="countAllSearch"  parameterType="net.hb.crud.BoardDTO"  resultType="int" >
		select count(*) from board where ${skey} like '%' || #{sval} || '%'  
	</select>
	
	
	<!--  -->
	<select id="selectAll" resultType="net.hb.crud.BoardDTO" parameterType="net.hb.crud.BoardDTO">
	   	select * from (
	   		select  rownum rn, h.* ,(select count(*) from hobby_reply r where r.hobby_idx=h.hobby_idx) as rcnt from hobby h
		) where rn between #{start} and #{end}
	</select>

	
	
	<!-- 한건수정 -->
	<update id="edit">
		update board set topic=#{topic}, title=#{title}, bcontent=#{bcontent} 
		where board_idx=#{board_idx}
	</update>
	
	<!-- 한건삭제 -->
	<delete id="delete" parameterType="int">
		delete from board where board_idx=#{hobby_idx}
	</delete>
	
	<!-- 댓글삽입 -->
	<insert id='replyInsert' parameterType="net.hb.crud.BoardDTO">
		insert into board_reply values (board_reply_seq.nextval, #{rwriter}, #{rcontent}, sysdate, #{board_idx})
	</insert>
	
	<!-- 댓글출력 -->
	<select id='replySelect' resultType="net.hb.crud.BoardDTO" parameterType="int">
		select  rwriter, rcontent, to_char(rdate,'YYYY.MM.DD') as rdate
		from board_reply where board_idx=#{board_idx} order by rdate
	</select>
	
	<!--  검색+페이징 동적쿼리문  -->
	<select id="selectAllDynamic"  resultType="net.hb.crud.BoardDTO">
		select * from (
		select  rownum as rn, h.* from  (
		select * from hobby 
		
		<if test="skey != null">
			<if test="skey == 'name'">
				where name like '%' || #{sval} || '%'
			</if>
			<if test="skey == 'title'">
				where title like '%' || #{sval} || '%'
			</if>
			<if test="skey == 'content'">
				where content like '%' || #{sval} || '%'
			</if>
		</if>
		   order by hobby_idx 
		  ) h
	   ) where rn between #{start} and #{end}
	</select>	
</mapper>







