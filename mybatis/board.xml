<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">	

	<insert id="signupInsert" parameterType="net.hb.crud.BoardDTO">
	   insert into customer
	   values(customer_seq.nextVal, #{custname}, #{custid}, #{custpassword}, #{clevel}, 0)    
	</insert>

	<select id="selectAll" resultType="net.hb.crud.BoardDTO" parameterType="net.hb.crud.BoardDTO">
	   	select * from (
	   		select  rownum rn, h.* ,(select count(*) from hobby_reply r where r.hobby_idx=h.hobby_idx) as rcnt from hobby h
		) where rn between #{start} and #{end}
	</select>

	<select id="countAll" resultType="int">
	   select count(*)  from hobby
	</select>
	
	<select id="detail" resultType="net.hb.crud.BoardDTO">
	   select rownum rn, b.* from hobby b where hobby_idx=#{hobby_idx}
	</select>
	
	<update id="edit">
		update hobby set name=#{name}, title=#{title}, content=#{content}, gender=#{gender}, hobby=#{hobby}, img_file_name=#{img_file_name} 
		where hobby_idx=#{hobby_idx}
	</update>
	
	<delete id="delete" parameterType="int">
		delete from hobby where hobby_idx=#{hobby_idx}
	</delete>
	
	<!-- 1015 -->
	<!--  검색 후 레코드갯수  -->
	<select id="countAllSearch"  parameterType="net.hb.crud.BoardDTO"  resultType="int" >
		select count(*) from hobby where ${skey} like '%' || #{sval} || '%'  
	</select>
	
	
	<!-- 검색+페이징 -->
	<select id="selectAll789" parameterType="net.hb.crud.BoardDTO" resultType="net.hb.crud.BoardDTO">
	   select  * from  (
	     select  rownum rn, h.* ,(select count(*) from hobby_reply r where r.hobby_idx=h.hobby_idx) as rcnt from 
	      (select * from hobby  where ${skey} like '%' ||  #{sval} ||  '%'  ) h 
	   ) where rn  between #{start} and  #{end} 
	</select>
	
	<!--  검색+페이징 동적쿼리문  -->
	<select id="selectAllDynamic"  resultType="net.hb.crud.BoardDTO">
		select * from (
		select  rownum as rn, h.* from  (
		select * from hobby 
		
		<if test="skey != null">
			<if test="skey == 'name'">
				where name like '%' || #{sval} || '%'
			</if>
			<if test="skey == 'title'">
				where title like '%' || #{sval} || '%'
			</if>
			<if test="skey == 'content'">
				where content like '%' || #{sval} || '%'
			</if>
		</if>
		   order by hobby_idx 
		  ) h
	   ) where rn between #{start} and #{end}
	</select>	
</mapper>







